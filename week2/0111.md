## 데이터베이스 설계

개체 / 속성 / 관계 세 가지를 중점에 두고 설계한다.

개체나 속성을 통해 추상화를 하고 관계를 맺어준다.

이렇게 관계를 맺어 데이터를 설계하는 방식을

Entity-Relation, ER 방식이라고 하고, 그를 표현하는 방식이

ER-Diagram, ERD라고 한다.

데이터베이스는 요건 분석, 스키마 정제, 데이터베이스 설계 3단계로 거쳐 설계가 된다.

### 요건 분석

데이터베이스를 설계하기 위해 요구사항을 분석해야 한다.

DB에 저장할 데이터와 이 데이터에서 지켜줘야 할 제약 정보를 기술하여

개념 설계를 한다.

### 스키마 정제

정규화를 통해 무결성 제약 조건에 관한 모든 정보들을 파악해서 테이블을 나누고 정제한다.

### 데이터베이스 설계

정규화 규칙에 맞게 정규화를 진행하면 테이블이 많이 쪼개져서 DB의 퀄리티는 높아질 수 있지만,

테이블이 쪼개져서 join이 많아져 성능 이슈가 생기기 때문에

이를 다시 비정규화하는 과정이 있을 수 있다.

이처럼 데이터베이스의 예상 작업 부하를 생각해서 설계를 적용해서

재설계하는 과정이 데이터베이스 설계이다.

### 개체 관계 데이터 모델

데이터를 개체 / 속성 / 관계로 나타내는 데이터 모델

실세계를 엔티티라 불리는 기본 객체들과 그 객체들 사이의 관계로 인식

### 개체

실제 세계에서 다른 객체과 구별되는 유, 무형의 사물

### 속성

- 한 개체를 기술하기 위한 속성으로, 개체 집합에 속한 모든 개체들은 동일한 속성을 가진다.
- 개체 안에 속성 중 후보 키로 쓸만한 속성이 없다면 하나 만들어줘서 개체 무결성을 유지해야 한다.
- 다중값 속성은 들어갈 수는 있지만 보통 사용하지 않고 테이블을 떼서 정규화한다.

### 관계

여러 개체들 사이에서 일대일, 다대일 등의 관계를 의미한다.

### 관계 집합

다대다일 경우에는 그 테이블의 관계를 나타내는 테이블 1개를 따로 만들어 총 3개가 모델링된다.

일대다일 경우에는 연관관계만 매핑해준다.

매핑할 때 Notation으로는 `IE Notation`을 주로 활용한다.

### 대응 수

참여 제약 조건을 이루는 관계 비율을 나타낸다.

Mapping Cardinality 또는 Cardinality Ratio 라고도 한다.

다음과 같이 구성되어 있다.

- 일대일(One-to-One)
- 일대다(One-to-Many)
- 다대일(Many-to-One)
- 다대다(Many-to-Many)

### 키 제약 조건

릴레이션에서 대응 수는 키 제약조건에 따라 결정된다.

- 상품과 주문 다대다 관계

  상품과 주문이 다대다 관계일 때, 서로 관계를 매핑해주는 테이블 하나를 만들어 연관관계를 설정해준다. 하지만 장바구니에 여러 상품을 담아 한번에 주문하는 상황을 만들고 싶을때,

  주문 테이블과 주문상세 테이블을 따로 만든다.

  상품은 주문상세와  일대다 관계, 주문상세와 주문은 다대일 관계, 주문과 고객은 일대다 관계로 세팅을 한다.


여기부터 상품과 게시판 실습

### 약 개체 집합

직원의 부양가족과 같은 경우, 부양가족의 데이터를 조회할 때 직원의 id를 보고 조회하게 되기 때문에 부양가족 테이블에서 따로 키가 필요하지 않다.

자기 자신의 키로 식별될 필요가 없이 부모 테이블의 키로 식별하는 개체들이 모인 집합을

약 개체 집합이라고 한다.

그래서 부모 테이블이 삭제 됐을 때 약개체집합의 자료들은 필요가 없어지기 때문에, 약 개체 집합을 생성할 때 `ON DELETE CASCADE` 조건을 걸어 준다.

### 세분화와 일반화

자바에서 상속받는 클래스가 구현되는 메서드가 더 많은 것과 같이,

데이터베이스에서도 이렇게 더 디테일한 부분들이 들어가는 것을 세분화라고 한다.

### ERD 모델링 설계

개체 or 속성

- 속성으로 모델링 하는 경우
    - 한 개체가 속성을 단일 값으로 가지는 경우
    - 요구사항에서 수직, 수평적으로 분리될 수 없는 값인 경우
- 개체로 모델링 하는 경우
    - 한 개체가 여러 개의 값을 가지는 경우
    - ER 다이어그램에서 주소의 구조를 표현해야 하는 경우